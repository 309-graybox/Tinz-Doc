---
tags:
  - camera
  - mechanics
  - target
  - new
aliases:
  - таргет
---
## Описание
---
Механика **Lock On Target** фиксирует ориентацию камеры и персонажа относительно выбранной цели либо текущего направления взгляда персонажа, обеспечивая стабильный боевой ракурс и читаемую композицию кадра.

Во время работы механики камера стремится удерживать в кадре **персонажа и цель**, либо — при отсутствии цели — фокусируется на персонаже, сохраняя кинематографичное начальное поведение.

Параметры механики описаны в [[Lock on Target (params)]].
## Принцип работы
---
### Прицеливание без захвата

- Система автоматически анализирует пространство вокруг персонажа и ищет ближайшую доступную цель в пределах заданного **радиуса обнаружения**.

- Если в радиусе находится несколько целей, выбирается ближайшая.

- Выбранная цель **подсвечивается символом прицеливания**, обозначающим потенциальную цель захвата.

>[!warning]  В прицел не должны попадаться цели находящиеся за стеной!
>Если цель в прицеле без захвата вдруг оказалась за стеной, то система должна мгновенно выбрать другую цель или просто убрать прицел если целей больше нет.
### Прицеливание с захватом цели
___
#### Захват цели
___

- При активации режима Lock On захватывается **та цель, которая была выделена в режиме прицеливания без захвата**.

- Символ прицеливания заменяется на **символ захвата цели**, обозначающий активную цель захвата.

**Начальное поведение камеры при входе в режим захвата:**

- Камера выполняет плавное кинематографичное выравнивание, определяющее начальный ракурс режима Lock On.

- Формируется новый якорь камеры, используемый для дальнейшего вращения и слежения. Камера фокусируется:
	- на средней точке между персонажем и целью, если цель найдена;
	- **на персонаже**, если захват активирован без доступной цели.

- Анимация поворота камеры при входе в режим захвата использует **ease out-кривую**, а не линейную интерполяцию, создавая ощущение мягкого замедления в конце движения.

- Горизонтальное вращение (Yaw) камеры стремится к целевому направлению:

	- при наличии цели — к ближайшему углу, кратному 90°, относительно линии персонаж → цель;
    
    - **при отсутствии цели** — камера поворачивается вдоль **forward-вектора персонажа**, открывая вид на то, на что в данный момент смотрит персонаж.
#### Во время захвата цели
---

- Камера удерживает **персонажа и цель** в кадре, динамически подстраиваясь под их движение.

- Точка обзора вычисляется на основе средней позиции между персонажем и целью с дополнительными оффсетами для читаемости кадра.

- Дистанция камеры динамически изменяется:

    - при увеличении расстояния до цели камера отдаляется;

- Вращение камеры:

    - **Pitch (вертикаль)** — ограничен для сохранения боевого ракурса;
    
    - **Yaw (горизонталь)** — свободный, вращение происходит вокруг оси между персонажем и целью.

- Камера использует интерполяцию для всех перемещений и поворотов, избегая резких рывков.

Так выглядит Lock on Target: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=JhZBLYfoqOA&controls=0" frameborder="0" allowfullscreen></iframe> 
Так он работает в движении: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=o5fnY8zjg_0&controls=0" frameborder="0" allowfullscreen></iframe> <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=DQ0Q6D2_kN8&controls=0" frameborder="0" allowfullscreen></iframe>
**Поведение при отсутствии или появлении цели:**

- Если активный захват цели теряется (цель погибает, выходит из радиуса, становится недоступной):

    - если в пределах радиуса обнаружения присутствуют другие допустимые цели, система автоматически выбирает **наиболее подходящую следующую цель**;

    - выполняется полный цикл захвата новой цели со всеми сопутствующими действиями камеры (перефокусировка, корректировка дистанции, начальное кинематографичное выравнивание), **как при повторном входе в режим захвата цели**;

    - если подходящих целей нет, система переходит в состояние **Lock On без цели**.

-  Если цель в активном захвате вдруг перекрывается геометрией уровня (например стеной):

	- Включается таймер, после истечения которого система должна будет выбрать новую цель, или перейти в состояние **Lock On без цели**, если других целей нет.

	- Если цель снова появляется в пределах видимости до истечения таймера, то он останавливается и обновляется. 
  
- В состоянии **Lock On без цели**:

    - камера фокусируется на персонаже;

    - сохраняется текущее направление и якорь камеры без резкого пересчёта.

- Если во время состояния Lock On без цели в радиусе появляется новая цель:

    - камера автоматически захватывает её;

    - выполняется плавное перенаправление фокуса и дистанции с инициализацией поведения захвата цели.

Так выглядит лок без цели: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=GahLjBslHvg&controls=0" frameborder="0" allowfullscreen></iframe>
Поведение камеры если во время Lock on traget цель пропала: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=AB4XGn2a-gc&controls=0" frameborder="0" allowfullscreen></iframe> 
Поведение камеры если во время лока без цели появится новая цель: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=cAix4zD6Km8&controls=0" frameborder="0" allowfullscreen></iframe>

#### Отпускание цели
---
- При отпускании кнопки таргета режим Lock On деактивируется.

- Камера возвращается в стандартный режим:

    - **мгновенно**, если игрок вводит любое управляющее действие;
    
    - **через заданное время**, если игрок не совершает инпутов.
    
- Возврат сопровождается плавной интерполяцией позиции и вращения.

- Если режим был активен **без цели**, возврат камеры происходит из текущего направления взгляда персонажа без дополнительного переориентирования.

Поведение камеры после снятия лока на цели, если игрок начал двигаться: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=P5FbH70Lxpo&controls=0" frameborder="0" allowfullscreen></iframe>
Поведение камеры после снятия лока на цели, если игрок стоит без действия: <iframe id="ytplayer" type="text/html" width="720" height="405" src="https://www.youtube.com/embed/?autoplay=1&enablejsapi=1&loop=1&playlist=-Rb6VATej0w&controls=0" frameborder="0" allowfullscreen></iframe>
## См. также
---
- [[Lock on Target (params)]]